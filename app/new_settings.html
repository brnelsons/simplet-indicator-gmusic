<!DOCTYPE html>
<html>
<script>window.$ = window.jQuery = require('./res/js/jquery.js');</script>
<script>var angular = require('angular');</script>
<script>var settingsModule = require('./res/modules/settings-module')</script>
<script src="res/js/bootstrap.js"></script>
<link href="res/css/bootstrap.css" rel="stylesheet">
<link href="res/css/style.css" rel="stylesheet">

<body ng-app="myApp" ng-controller="myCtrl" style="background: #fff;">
<div class="container">
    <div class="alert alert-warning">
        <script src="res/js/settings.js"></script>
        <ul>
            <li>Flash is NOT supported by GMusic(indicator).</li>
            <li>Pandora and Spotify currently use Flash.</li>
        </ul>
    </div>

    <hr>

    <div class="row setting">
        <div class="col-xs-6">
            <input type="button" class="btn btn-success center-block" value="Save" ng-click="save()"/>
        </div>
        <div class="col-xs-6">
            <input type="button" class="btn btn-warning center-block" value="Cancel" ng-click="close()"/>
        </div>
    </div>

    <hr>

    <div class="container" ng-repeat="settingGroup in allSettings" style="padding:0 25px 0;">
        <div class="row">
            <h4 class="settings-header">{{settingGroup.DISPLAY_NAME}}</h4>
        </div>
        <div class="row setting" ng-repeat="setting in settingGroup.VALUES">
            <div class="input-group">
                <span class="input-group-addon" id="{{setting.NAME}}">{{setting.DISPLAY_NAME}}</span>
                <!--buttons-->
                <span class="input-group-btn" ng-if="setting.TYPE == 'BUTTONS'">
                    <button class="btn btn-default" type="button" name="{{setting.NAME}}"
                            value="{{option.VALUE}}"
                            aria-describedby="{{setting.NAME}}"
                            ng-repeat="option in setting.OPTIONS">{{option.DISPLAY_NAME}}
                    </button>
                </span>
                <!--TEXT-->
                <input type="text" class="form-control" style="min-width:200px;" name="{{setting.NAME}}"
                       ng-if="setting.TYPE == 'TEXT'" aria-describedby="{{setting.NAME}}"
                       placeholder="{{setting.DESC}}">
                <!--NUMBERS-->
                <input type="number" class="form-control" style="min-width:200px;" name="{{setting.NAME}}"
                       ng-if="setting.TYPE == 'NUMBER'" aria-describedby="{{setting.NAME}}"
                       placeholder="{{setting.DESC}}">
                <!--DROPDOWN-->
                <div class="input-group-addon input-group-dropdown" ng-if="setting.TYPE == 'DROPDOWN'">
                    <select name="{{setting.NAME}}" title="{{setting.NAME}}">
                        <option ng-repeat="option in setting.OPTIONS" value="{{option.VALUE}}">{{option.DISPLAY_NAME}}
                        </option>
                    </select>
                </div>
            </div>
        </div>
        <hr>
    </div>
</div>
<script>
    var app = angular.module("myApp", []);
    app.controller("myCtrl", function ($scope) {
        var settingsUtil = require('./res/modules/setting-util-module');
        $scope.allSettings = settingsModule.SETTINGS;
        $scope.change = function (setting, value) {

        };
        function deactivateButtons(buttons) {
            buttons.removeClass('active');
        }

        function updateButtons(optionValue, settingName) {
            console.log("OPT:"+optionValue + ": settingName: " + settingName);
            deactivateButtons($('button[type=button][name="' + settingName + '"]'));
            $($('button[type=button][name="' + settingName + '"][value="' + optionValue + '"]')).addClass('active');
            $($('input[name="'+settingName+'"]')).val(optionValue);
            $('select[name="'+settingName+'"]>option[value="'+optionValue+'"]').prop('selected', true)
        }

        function loadAll() {
            var allSettings = settingsModule.SETTINGS;
            for (var settings in allSettings) {
                if (allSettings.hasOwnProperty(settings)) {
                    var settingValues = allSettings[settings].VALUES;
                    for(var values in settingValues){
                        if(settingValues.hasOwnProperty(values)) {
                            var valueName = settingValues[values].NAME;
                            //uncomment this for logging
//                            console.log(settings+":" +values + ":" + valueName + "=" + settingsUtil.getForUi(valueName));
                            updateButtons(settingsUtil.getForUi(valueName), valueName);
                        }
                    }
                }
            }
        }

        $scope.close = function () {
            //todo ask user to save?
            setTimeout(function () {
                ipcRenderer.send('close-settings');
            }, 500);
        };
        $(document).ready(function(){
            loadAll();
        })
    });
</script>

</body>
</html>

